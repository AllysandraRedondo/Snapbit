<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Circle Swiper</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/3.5.0/remixicon.css">
  <link href="https://fonts.googleapis.com/css2?family=Madimi+One&family=Lexend:wght@100..900&family=Reenie+Beanie&display=swap" rel="stylesheet">
<style>
  /* üé® Basic reset */
* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  font-family: Arial, sans-serif;
  text-align: center;
  background: linear-gradient(to top right, #C8DBF8 2%, #D6E4F9 27%, #FFFCE9 84%);
  background-attachment: fixed;
  overflow: hidden;
}

/* üì∏ Layout */
.row {
  display: flex;
  justify-content: center;
  align-items: flex-start; /* ‚úÖ top-align so left doesn‚Äôt move */
  gap: 100px;
  margin-top: 30px;
  margin-left: -200px;
}

.left {
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  gap: 20px;

}

.camera-txt p {
  font-size: 45px;
  text-align: left;
  font-family: Reenie Beanie;
  margin-top: 20px;
}

.camera canvas {
  width: 750px;
  height: 450px;
  border: 2px solid #fff;
  border-radius: 10px;
}

/* üñ®Ô∏è Print button */
.button-print button {
  width: 180px;
  height: 70px;
  border: none;
  border-radius: 20px;
  background: #FFF7D9;
  font-size: 20px;
  cursor: pointer;
  margin-top: 40px;
  font-family: Lexend;
  border: 2px solid #482A41;
}


/* üéÄ Right panel */
.design {
  display: flex;
  flex-direction: column; 
  align-items: flex-start;
  gap: 40px;
  position: relative;
  width: 200px; /* fixed width to avoid flex resizing */
  margin-top: 100px;
}




/* üß© Sticker Dropdown */
.dropdown_background,
.dropdown_sticker,
.dropdown_filter {
  position: relative;

}
.dropdown_button.sticker{
  background: #ffec4f;
}
.dropdown_button.background{
  background: #EBEFFF;
}
.dropdown_button.filter{
  background: #FFC58B;
}
/* Dropdown content should push other buttons down */
.dropdown_button {
  width: 100%;
  height: 60px;
  border: none;
  border-radius: 60px; /* default corners */
  font-size: 20px;
  padding: 0 25px;
  display: flex;
  align-items: center;
  cursor: pointer;
  font-family: Madimi One;
  justify-content: flex-start; /* triangle stays left */
  gap: 10px; /* space between text and triangle */
}

.triangle {
  width: 0;
  height: 0;
  border-left: 10px solid transparent;
  border-right: 10px solid transparent;
  border-top: 12px solid white;
  position: relative;
}



.dropdown_content.sticker{
  background: #ffec4f;
}
.dropdown_content.background{
  background: #EBEFFF;
}
.dropdown_content.filter{
  background: #FFC58B;
}
/* Dropdown content */
.dropdown_content {
  display: none;
  border-radius: 20px;
  padding: 15px;
  margin-top: -25px;
  animation: fadeIn 0.2s ease;
  border-top-left-radius: 0;
  border-top-right-radius: 0;
  border-bottom-left-radius: 20px;
  border-bottom-right-radius: 20px;
}

/* When open ‚Äî pushes others below ‚úÖ */
.dropdown_content.show {
  display: block;
}




.sticker-grid {
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  gap: 10px;
}

.sticker-grid img {
  width: 65px;
  height: 65px;
  border-radius: 50%;
  background: white;
  padding: 5px;
  cursor: pointer;
}

/* ü™û Popup */
.pop {
            display: none; 
            z-index: 1000;
              position: fixed;     /* ‚úÖ make it fixed to viewport */
  top: 0;
  left: 0;
 width: 100%;   /* full screen width */
  height: 100%;

}

.popup {
  font-family: Arial, sans-serif;
  background-color: #E7F6F3;
  padding: 30px;
  text-align: center;
  border-radius: 15px;
 width: 100vw;   /* full screen width */
  height: 100vh;  /* ‚úÖ responsive height */
  overflow: auto;   /* ‚úÖ scroll if content too tall */
  position: relative;
 width: 100vw;
  height: 100vh;
  display: flex;             /* make it flex */
  align-items: center;       /* center vertically */
  justify-content: center;   /* center horizontally */
  flex-direction: column;    /* stack content */
}


    .back {
      position: absolute;
      top: 30px;
      left: 40px;
      font-size: 23px;
      text-decoration: none;
      color: black;
      border: none;
      background-color: #E7F6F3;
    }

    h2 {
      margin-top: 25px;
      margin-bottom: 15px;
    }

    /* frame style*/
    .image-container {
      background: #FFFFFF;
      display: inline-block;
      padding: 20px;
      border-radius: 15px;
      border: 2px solid #fffefe; 
    }
    .image-container img{
      width: 680px;
      height: 420px;
    }
    .question {
      margin: 30px 0 30px;
      font-size: 15px;
    }

    .print-btn {
      padding: 14px 30px;
      border: 2px dashed #7C5EFF;
      border-radius: 25px;
      background: #FEFEFE;
      font-size: 16px;
      cursor: pointer;
      transition: 0.3s;
    }

    .print-btn:hover {
      background: #7C5EFF;
      color: #FFFFFF;
    }

</style>
</head>
<body>
<div class="row">
  <div class="left">
    <div class="camera-txt">
      <p>Design Your Picture</p>
    </div>
    <div class="center">
      <div class="camera">
        <canvas id="canvas"></canvas>
      </div>
      <div class="button-print">
        <button class="print" onclick="showPopup()">Print</button>
      </div>
    </div>
  </div>

  <div class="design">
    <!-- Background Dropdown -->
    <div class="background">
      <div class="dropdown_background">
        <button class="dropdown_button background" id="dropdownButtonBackground">
          <div>Border</div>
          <div class="triangle"></div>
        </button>
        <div class="dropdown_content background" id="dropdownBackground">
          <div class="sticker-grid" id="backgroundWrapper"></div>
        </div>
      </div>
    </div>

    <!-- Sticker Dropdown -->
    <div class="sticker">
      <div class="dropdown_sticker">
          <button class="dropdown_button sticker">
            <span class="btn-text">Stickers</span>
            <div class="triangle"></div>
          </button>
        <div class="dropdown_content sticker" id="dropdownSticker">
          <div class="sticker-grid" id="stickerWrapper"></div>
        </div>
      </div>
    </div>

    <!-- Filter Dropdown -->
    <div class="filter">
      <div class="dropdown_filter">
        <button class="dropdown_button filter" id="dropdownButtonFilter">
          <div>Filters</div>
          <div class="triangle"></div>
        </button>
        <div class="dropdown_content filter" id="dropdownFilter">
          <div class="sticker-grid" id="filterWrapper"></div>
        </div>
      </div>
    </div>
  </div>
</div>


<div class="pop" id="pop">
  <div class="popup">
  <button class="back" onclick="hidePopup()">‚óÄ Go Back</button>

  <h2>Here‚Äôs Your Image</h2>

  
  <div class="image-container">
    <div class="image-grid">
        <img id = "previewImage" class = "preview-Image" alt="Your Photo">
    </div>
  </div>

  <p class="question">Are you satisfied with the design?</p>

  <button class="print-btn" onclick= "download()">Print My Picture</button>
</div>
</div>






  <!-- PARA SA BACKGROUND -->
<script>
  function changeBackground(backgroundId) {
    const backgrounds = {
      bg1: "static/Images/backgrounds/bg1.jpg",
      bg2: "static/Images/backgrounds/bg2.jpg",
      bg3: "static/Images/backgrounds/bg3.jpg",
      bg4: "static/Images/backgrounds/bg4.jpg",
      bg5: "static/Images/backgrounds/bg5.jpg"
    };

    if (backgrounds[backgroundId]) {
      fabric.Image.fromURL(backgrounds[backgroundId], function(img) {
        canvas.setBackgroundImage(
          img,
          canvas.renderAll.bind(canvas),
          {
            scaleX: canvas.width / img.width,
            scaleY: canvas.height / img.height,
            originX: "left",
            originY: "top"
          }
        );
      });
    } else {
      console.warn("Unknown background:", backgroundId);
    }
  }
</script>


<!-- PARA MA DISPLAY YUNG IMAGE -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.0/fabric.min.js"></script>
<script>
  const canvas = new fabric.Canvas("canvas");

  // Load photos from localStorage
  const photos = JSON.parse(localStorage.getItem('capturedPhotos')) || [];
  if (photos.length === 0) {
    alert("No photos found. Please take photos first.");
    window.location.href = "camera.html";
  }

  // Canvas size
  canvas.setWidth(750);
  canvas.setHeight(500);
  canvas.setBackgroundColor("white", canvas.renderAll.bind(canvas));

  // üîπ Function: return slot positions depending on number of photos
  function getSlotPositions(photoCount) {
    if (photoCount === 3) {
      // Template 1: 2 top, 1 bottom
      return [
        { x: 50,  y: 50,  width: 300, height: 180 },
        { x: 400, y: 50,  width: 300, height: 180 },
        { x: 220, y: 270, width: 300, height: 180 }
      ];
    }

    if (photoCount === 4) {
      // Template 2: 2x2 grid
      return [
        { x: 50,  y: 50,  width: 300, height: 180 },
        { x: 400, y: 50,  width: 300, height: 180 },
        { x: 50,  y: 270, width: 300, height: 180 },
        { x: 400, y: 270, width: 300, height: 180 }
      ];
    }

    if (photoCount === 5) {
      // Template 3: 3 top, 2 bottom
      return [
        { x: 45,  y: 80,  width: 200, height: 150 },
        { x: 273, y: 80,  width: 200, height: 150 },
        { x: 500, y: 80,  width: 200, height: 150 },
        { x: 160, y: 270, width: 200, height: 150 },
        { x: 390, y: 270, width: 200, height: 150 }
      ];
    }

    // Default: empty
    return [];
  }

  // üîπ Load Photos into Auto-Layout (with flip fix)
  function loadPhotos() {
    const slots = getSlotPositions(photos.length);

    if (slots.length === 0) {
      alert("Unsupported number of photos. Please take 3, 4, or 5 photos.");
      return;
    }

    photos.forEach((photoSrc, index) => {
      if (index >= slots.length) return; // stop if more photos than slots
      const slot = slots[index];

fabric.Image.fromURL(photoSrc, img => {
  img.set({
    left: slot.x + slot.width / 2,
    top: slot.y,
    scaleX: -(slot.width / img.width),
    scaleY: slot.height / img.height,
    originX: "center",
    selectable: false,   // üöÄ cannot select/move
    evented: false       // üöÄ ignores clicks
  });
  canvas.add(img);
  canvas.sendToBack(img);
});


    });
  }

  loadPhotos();
</script>

  <!-- PARA SA STICKERS -->
  <script>
    // üß© Replace this with your GitHub Pages sticker URL
    const baseURL = "https://cdn.jsdelivr.net/gh/allysandraredondo/stickers-lib/images/";

    // üñºÔ∏è List of your sticker image filenames
    const stickers = [
      "cat_1.png", "cat_2.png", "cat_3.png", "cat_4.png",
      "heart_1.png", "heart_2.png",
      "rabbit_1.png", "rabbit_2.png", "cat_5.png", "cat_6.png"
    ];

  const deleteImg = new Image();
  deleteImg.src = "https://cdn-icons-png.flaticon.com/512/5974/5974771.png";

  // üé® Add stickers dynamically
  const stickerWrapper = document.getElementById("stickerWrapper");
  stickers.forEach(stickerFile => {
    const img = document.createElement("img");
    img.src = baseURL + stickerFile;
    img.dataset.img = baseURL + stickerFile;
    img.classList.add("sticker-item");
    img.addEventListener("click", () => addSticker(img));
    stickerWrapper.appendChild(img);
  });

  // üß∑ Add sticker to Fabric.js canvas
  function addSticker(el) {
    const imgUrl = el.getAttribute("data-img");
    fabric.Image.fromURL(imgUrl, function(sticker) {
      sticker.set({
        left: 150,
        top: 100,
        scaleX: 0.3,
        scaleY: 0.3,
        selectable: true
      });

      sticker.controls.deleteControl = new fabric.Control({
        x: 0.5,
        y: -0.5,
        offsetY: -16,
        offsetX: 16,
        cursorStyle: 'pointer',
        mouseUpHandler: function(_, transform) {
          canvas.remove(transform.target);
          canvas.requestRenderAll();
        },
        render: function(ctx, left, top) {
          const size = 20;
          ctx.drawImage(deleteImg, left - size / 2, top - size / 2, size, size);
        }
      });

      canvas.add(sticker).setActiveObject(sticker);
    }, { crossOrigin: 'anonymous' });
  }

  // ü©µ Dropdown logic for ALL dropdowns
  document.querySelectorAll(".dropdown_button").forEach(button => {
    button.addEventListener("click", (e) => {
      e.stopPropagation();
      const dropdown = button.nextElementSibling;
      dropdown.classList.toggle("show");
    });
  });

  // Close dropdowns when clicking outside
  window.addEventListener("click", (event) => {
    if (!event.target.closest(".dropdown_background") &&
        !event.target.closest(".dropdown_sticker") &&
        !event.target.closest(".dropdown_filter")) {
      document.querySelectorAll(".dropdown_content").forEach(drop => {
        drop.classList.remove("show");
      });
    }
  });
</script>

<!-- DOWNLOADING IMAGE -->
<script>
function download() {
    // Save image from canvas
    const imageData = canvas.toDataURL("image/jpeg");

    fetch("/save_photo", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ image: imageData })
    })
    .then(res => res.json())
    .then(data => {
        console.log("Photo saved:", data.filename);
        // Simulate printing (can use window.print if needed)
        // Redirect to waiting page
        window.location.href = "/waiting";
    });
}
</script>



<!-- CONFORMATION PAGE -->
<script>
var div = document.getElementById('pop');
var previewImg = document.getElementById('previewImage');

function showPopup(){
  // Show popup
  div.style.display = 'block';

  // Save the image + show preview
  const imageData = canvas.toDataURL("image/png");
  previewImg.src = imageData; // ‚úÖ show in popup
}

function hidePopup(){
  div.style.display = 'none';
}
</script>


</body>
</html>